
<link rel="stylesheet" href="/css/profile.css">
<section>
    <div class="profile-container">
        <!-- Header Banner -->
        <div class="profile-header">
            <button id="btnVoltar" class="btn-back">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                <a href="/" style="text-decoration: none;">
                    Voltar
                </a>
            </button>

            <div class="profile-banner">
                <div class="avatar-section">
                    <div class="user-info">
                        <h1 id="displayNome"><%= lista.usu_nome %></h1>
                        <p id="displayEmail"><%= lista.usu_email %></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="profile-content">
            <div class="container">
                <div class="row g-4">
                    <!-- Left Column - Quick Info -->
                    <div class="col-lg-4">
                        <div class="info-card">
                            <div class="avatar-wrapper-card">
                                <% if (typeof lista !== "undefined" && lista && lista.usu_url_imagem) { %>
                                    <img id="imgPerfil" src="<%= lista.usu_url_imagem %>" alt="avatar">
                                <% } else { %>
                                    <img id="imgPerfil" src="/img/default-avatar.jpg">
                                <% } %>

                                <label for="inputFoto" id="btnTrocarFoto" class="btn-change-photo">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                        <circle cx="12" cy="13" r="4"/>
                                    </svg>
                                </label>
                                <input type="file" id="inputFoto" accept="image/*" hidden>
                            </div>

                            <h2 class="section-title">Informações Rápidas</h2>

                            <div class="info-item">
                                <div class="info-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                </div>
                                <div class="info-content">
                                    <span class="info-label">Nome Completo</span>
                                    <span class="info-value" id="infoNome"><%= lista.usu_nome %></span>
                                </div>
                            </div>

                            <div class="info-item">
                                <div class="info-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                </div>
                                <div class="info-content">
                                    <span class="info-label">Email</span>
                                    <span class="info-value" id="infoEmail"><%= lista.usu_email %></span>
                                </div>
                            </div>

                            <div class="info-item">
                                <div class="info-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                                    </svg>
                                </div>
                                <div class="info-content">
                                    <span class="info-label">Telefone</span>
                                    <span class="info-value" id="infoTelefone">
                                        <% if(lista.usu_numero) { %>
                                            (<%= lista.usu_numero.slice(0,2) %>) <%= lista.usu_numero.slice(2,7) %>-<%= lista.usu_numero.slice(7,11)%>
                                        <% } else { %>
                                            (00) 00000-000
                                        <% } %>
                                    </span>
                                </div>
                            </div>

                            <div class="info-item">
                                <div class="info-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 6v6l4 2"/>
                                    </svg>
                                </div>
                                <div class="info-content">
                                    <span class="info-label">Gênero</span>
                                    <span class="info-value" id="infoGenero"><%= lista.usu_genero %></span>
                                </div>
                            </div>

                            <div class="status-badge">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="12" cy="12" r="10"/>
                                </svg>
                                Conta Ativa
                            </div>
                        </div>

                        <div class="info-card profile-actions-card">
                            <% if(perfil === 1) { %> 
                                <a href="/dashboard" class="btn-profile-big">
                                    Ir para Dashboard
                                </a>
                                <a href="/logout" class="btn-profile-big logout">
                                    Sair da Conta
                                </a>
                            <% } else { %>
                                <a href="/logout" class="btn-profile-big logout">
                                    Sair da Conta
                                </a>
                            <% } %>
                        </div>
                    </div>

                    <!-- Right Column - Edit Form -->
                    <div class="col-lg-8">
                        <div class="edit-card">
                            <h2 class="section-title">Editar Informações</h2>
                            <div id="formAlterar" class="edit-form">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="nome" class="form-label">Nome Completo</label>
                                            <input type="text" class="form-control" id="nome" value="<%= lista.usu_nome %>" placeholder="Seu nome completo">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="email" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="email" value="<%= lista.usu_email %>" placeholder="seu@email.com">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="telefone" class="form-label">Telefone</label>
                                            <input type="tel" class="form-control" id="telefone" 
                                            value="<% if(lista.usu_numero) { %> (<%= lista.usu_numero.slice(0,2) %>) <%= lista.usu_numero.slice(2,7) %>-<%= lista.usu_numero.slice(7,11)%> <% } %>" maxlength="15" placeholder="(00) 00000-0000"/>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="genero" class="form-label">Gênero</label>
                                            <select class="form-control" id="genero">
                                                    <% if(lista.usu_genero === "masculino") { %>
                                                    <option value="<%= lista.usu_genero %>"><%= lista.usu_genero %></option>
                                                    <option value="feminino">feminino</option>
                                                    <option value="outro">outro</option>
                                                <% } else if(lista.usu_genero === "feminino") { %>
                                                    <option value="<%= lista.usu_genero %>"><%= lista.usu_genero %></option>
                                                    <option value="masculino">masculino</option>
                                                    <option value="outro">outro</option>
                                                <% } else { %>
                                                    <option value="<%= lista.usu_genero %>"><%= lista.usu_genero %></option>
                                                    <option value="masculino">masculino</option>
                                                    <option value="feminino">feminino</option>
                                                <% } %>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-actions">
                                            <button type="button" id="btnCancelar" class="btn-secondary">Cancelar</button>
                                            <button type="submit" id="btnAlterar" class="btn-primary">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                                    <polyline points="7 3 7 8 15 8"/>
                                                </svg>
                                                Salvar Alterações
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Address Section -->
                        <div class="address-section">
                            <div class="address-header">
                                <h2 class="section-title">Gerenciar Endereço</h2>
                                <button id="btnToggleEndereco" class="btn-toggle">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"/>
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                    </svg>
                                    Adicionar Endereço
                                </button>
                            </div>

                            <div id="formEnderecoContainer" class="address-form-container">
                                <div id="formEndereco" class="address-form">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="inputCep" class="form-label">CEP</label>
                                                <input type="text" class="form-control" id="inputCep" name="cep" placeholder="00000-000" maxlength="8">
                                            </div>
                                        </div>

                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label for="inputRua" class="form-label">Rua</label>
                                                <input type="text" class="form-control" name="logradouro" placeholder="Rua, Avenida, etc" id="inputRua">
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="inputNumero" class="form-label">Número</label>
                                                <input type="text" class="form-control" name="numero" placeholder="Ex, 123, 12A" id="inputNumero">
                                            </div>
                                        </div>

                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label for="inputComplemento" class="form-label">Complemento</label>
                                                <input type="text" class="form-control" name="complemento" placeholder="Apto, Bloco, Casa, etc" id="inputComplemento">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="inputBairro" class="form-label">Bairro</label>
                                                <input type="text" class="form-control" name="bairro" placeholder="Seu bairro" id="inputBairro">
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="inputCidade" class="form-label">Cidade</label>
                                                <input type="text" class="form-control" name="cidade" placeholder="Sua cidade" id="inputCidade">
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="inputEstado" class="form-label">Estado</label>
                                                <input type="text" class="form-control" name="estado" placeholder="SP" id="inputEstado" maxlength="2">
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="form-actions">
                                                <button type="button" id="btnLimparCampo" class="btn-secondary">Limpar</button>
                                                <button type="submit" id="btnRegistrarEndereco" class="btn-primary">
                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                                        <circle cx="12" cy="10" r="3"/>
                                                    </svg>
                                                    Salvar Endereço
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="addresses-list">
                            <h2 class="section-title">Endereços Cadastrados</h2>

                            <% listaEndereco.forEach((endereco, index) => { %>
                                <% if(endereco.usuID === "") { %>
                                    <div class="address-card">
                                        <div class="address-summary">
                                            <div class="address-main">
                                                <h5 class="address-title">Nenhum endereço cadastrado ainda.</h5>
                                                <span class="address-mini">
                                                    -------- • -------- • --------
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                <% } else { %>
                                    <div id="listaEnderecos">
                                    <div class="address-card" data-id="<%= endereco.endID %>">
                                        <div class="address-card-header">
                                            <div class="address-summary">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                                    <circle cx="12" cy="10" r="3"/>
                                                </svg>
                                                <span>
                                                    <%= endereco.endEstado %> - CEP <%= endereco.endCep %> - Nº <%= endereco.endNumero %>
                                                </span>
                                            </div>
                                            <button class="btn-toggle-details" data-target="<%= index %>">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <polyline points="6 9 12 15 18 9"/>
                                                </svg>
                                            </button>
                                        </div>

                                        <div id="<%= index %>" class="address-details">
                                            <div class="detail-row">
                                                <span class="detail-label">Rua:</span>
                                                <span class="detail-value view-mode"><%= endereco.endLogradouro %></span>
                                                <input type="text" class="form-control edit-mode d-none" name="logradouro" placeholder="Rua, Avenida, etc" id="inputRua">
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Complemento:</span>
                                                <span class="detail-value view-mode"><%= endereco.endComplemento %></span>
                                                <input type="text" class="form-control edit-mode d-none" name="complemento" placeholder="Apto, Bloco, Casa, etc" id="inputComplemento">
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Bairro:</span>
                                                <span class="detail-value view-mode"><%= endereco.endBairro %></span>
                                                <input type="text" class="form-control edit-mode d-none" name="bairro" placeholder="Seu bairro" id="inputBairro">
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Cidade:</span>
                                                <span class="detail-value view-mode"><%= endereco.endCidade %></span>
                                                <input type="text" class="form-control edit-mode d-none" name="cidade" placeholder="Sua cidade" id="inputCidade">
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">CEP:</span>
                                                <span class="detail-value view-mode"><%= endereco.endCep %></span>
                                                <input type="text" class="form-control edit-mode d-none" id="inputCep" name="cep" placeholder="00000-000" maxlength="8">
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Numero:</span>
                                                <span class="detail-value view-mode"><%= endereco.endNumero %></span>
                                                <input type="text" class="form-control edit-mode d-none" name="numero" placeholder="Ex, 123, 12A" id="inputNumero">
                                            </div>
                                            <div class="detail-row">
                                                <span class="detail-label">Estado:</span>
                                                <span class="detail-value view-mode"><%= endereco.endEstado %></span>
                                                <input type="text" class="form-control edit-mode d-none" name="estado" placeholder="SP" id="inputEstado" maxlength="2">
                                            </div>
                                            <div class="address-actions">
                                                <button class="btn-primary btn-edit">
                                                    Editar
                                                </button>

                                                <button class="btn-remove btnDeletar" data-delete-address="<%= endereco.endID %>" id="btnDeletar">
                                                    Remover Endereço
                                                </button>

                                                <button class="btn-secondary btn-save d-none">
                                                    Salvar
                                                </button>

                                                <button class="btn-cancel d-none">
                                                    Cancelar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            <% }) %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const btnToggleEndereco = document.getElementById("btnToggleEndereco");
        const formContainer = document.getElementById("formEnderecoContainer");

        if (btnToggleEndereco && formContainer) {
            btnToggleEndereco.addEventListener("click", function () {
                formContainer.classList.toggle("show");
                btnToggleEndereco.classList.toggle("active");
            });
        }

        const inputFoto = document.getElementById("inputFoto");
        const imgPerfil = document.getElementById("imgPerfil");

        if (inputFoto && imgPerfil) {
            inputFoto.addEventListener("change", function () {

                const file = this.files[0];
                if (!file) return;

                imgPerfil.src = URL.createObjectURL(file);

            });
        }

        document.addEventListener("click", function (e) {
            const button = e.target.closest(".btn-toggle-details");
            if (!button) return;

            const targetId = button.getAttribute("data-target");
            const details = document.getElementById(targetId);
            if (!details) return;

            const isOpen = details.classList.contains("show");

            document.querySelectorAll(".address-details").forEach(el => {
                el.classList.remove("show");
            });

            document.querySelectorAll(".btn-toggle-details").forEach(btn => {
                btn.classList.remove("active");
            });

            if (!isOpen) {
                details.classList.add("show");
                button.classList.add("active");
            }
        });
    });

    document.querySelectorAll(".address-card").forEach(card => {

        const btnEdit = card.querySelector(".btn-edit");
        const btnSave = card.querySelector(".btn-save");
        const btnRemove = card.querySelector(".btnDeletar");
        const btnCancel = card.querySelector(".btn-cancel");

        const views = card.querySelectorAll(".view-mode");
        const inputs = card.querySelectorAll(".edit-mode");

        btnEdit.addEventListener("click", () => {

            views.forEach(v => v.classList.add("d-none"));
            inputs.forEach(i => i.classList.remove("d-none"));

            btnEdit.classList.add("d-none");
            btnRemove.classList.add("d-none");

            btnSave.classList.remove("d-none");
            btnCancel.classList.remove("d-none");

        });

        btnSave.addEventListener("click", () => {

            inputs.forEach((input, index) => {
                views[index].textContent = input.value;
            });

            views.forEach(v => v.classList.remove("d-none"));
            inputs.forEach(i => i.classList.add("d-none"));

            btnEdit.classList.remove("d-none");
            btnRemove.classList.remove("d-none");

            btnSave.classList.add("d-none");
            btnCancel.classList.add("d-none");

        });

        btnCancel.addEventListener("click", () => {

            views.forEach(v => v.classList.remove("d-none"));
            inputs.forEach(i => i.classList.add("d-none"));

            btnEdit.classList.remove("d-none");
            btnRemove.classList.remove("d-none");

            btnSave.classList.add("d-none");
            btnCancel.classList.add("d-none");
        });
    });
</script>
