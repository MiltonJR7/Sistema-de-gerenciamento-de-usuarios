
<link rel="stylesheet" href="/css/perfilStyle.css"/>
<link rel="stylesheet" href="/css/enderecoPadrao.css">
<div class="perfil-page">
    <div class="perfil-decorative-banner"></div>

    <div class="perfil-container">
        <div class="perfil-grid">
            <aside class="perfil-sidebar">
                <div class="perfil-card">
                    <div class="perfil-avatar-section">
                        <div class="perfil-avatar">
                            <% if(lista.usu_url_imagem) { %>
                                <img id="avatarPreview"
                                src="/img/imageStorage/<%= lista.usu_url_imagem %>" alt="avatar">
                            <% } else { %>
                                <img id="avatarPreview"
                                src="https://img.freepik.com/vetores-premium/icone-de-perfil-de-avatar-padrao-imagem-de-usuario-de-midia-social-icone-de-avatar-cinza-silhueta-de-perfil-em-branco-ilustracao-vetorial_561158-3407.jpg"
                                alt="Foto do usuário">"
                            <% } %>
                        </div>
                        <button type="button" class="perfil-change-photo" id="btnTrocarFoto">
                            Alterar foto
                        </button>
                        <input type="file" id="avatarInput" name="imagem" accept="image/*" hidden>
                    </div>



                    <div class="perfil-info-list">
                        <div class="perfil-info-item">
                            <span class="perfil-info-label">Nome</span>
                            <span class="perfil-info-value"><%= lista.usu_nome %></span>
                        </div>
                        <div class="perfil-info-item">
                            <span class="perfil-info-label">E-mail</span>
                            <span class="perfil-info-value"><%= lista.usu_email %></span>
                        </div>
                        <div class="perfil-info-item" >
                            <span class="perfil-info-label">Telefone</span>
                            <span class="perfil-info-value">
                                <% if(lista.usu_numero) { %>
                                    (<%= lista.usu_numero.slice(0,2) %>) <%= lista.usu_numero.slice(2,7) %>-<%= lista.usu_numero.slice(7,11) %>
                                <% } else { %>
                                    (00) 00000-000
                                <% } %>
                            </span>
                        </div>
                        <div class="perfil-info-item">
                            <span class="perfil-info-label">Gênero</span>
                            <span class="perfil-info-value"><%= lista.usu_genero %></span>
                        </div>
                    </div>

                    <button class="perfil-back-button" onclick="window.history.back()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Voltar
                    </button>
                </div>
            </aside>

            <main class="perfil-main">
                <div class="perfil-card">
                    <div class="perfil-header">
                        <h2 class="perfil-title">Dados do usuário</h2>
                        <p class="perfil-subtitle">Atualize as informações vinculadas ao seu cadastro</p>
                    </div>

                    <form class="perfil-form">
                        <div class="perfil-form-group">
                            <label for="nome" class="perfil-form-label">Nome</label>
                            <input type="text" id="nome" class="perfil-form-control" placeholder="Seu nome completo" value="<%= lista.usu_nome %>" maxlength="100"/>
                        </div>

                        <div class="perfil-form-group">
                            <label for="email" class="perfil-form-label">E-mail</label>
                            <input type="email" id="email" class="perfil-form-control" placeholder="seu@email.com" value="<%= lista.usu_email %>" maxlength="100"/>
                        </div>

                        <div class="perfil-form-group">
                            <label for="Telefone" class="perfil-form-label">Telefone</label>
                            <input type="tel" id="telefone" class="perfil-form-control" placeholder="(00) 00000-0000" 
                            value="<% if(lista.usu_numero) { %> (<%= lista.usu_numero.slice(0,2) %>) <%= lista.usu_numero.slice(2,7) %>-<%= lista.usu_numero.slice(7,11) %> <% } %>" maxlength="15"/>
                        </div>

                        <div class="perfil-form-group">
                            <label for="genero" class="perfil-form-label">Gênero</label>
                            <select id="genero" class="perfil-form-control">
                                <% if(lista.usu_genero === "masculino") { %>
                                    <option value="<%= lista.usu_genero %>"><%= lista.usu_genero %></option>
                                    <option value="feminino">feminino</option>
                                    <option value="outro">outro</option>
                                <% } else if(lista.usu_genero === "feminino") { %>
                                    <option value="<%= lista.usu_genero %>"><%= lista.usu_genero %></option>
                                    <option value="masculino">masculino</option>
                                    <option value="outro">outro</option>
                                <% } else { %>
                                    <option value="<%= lista.usu_genero %>"><%= lista.usu_genero %></option>
                                    <option value="masculino">masculino</option>
                                    <option value="feminino">feminino</option>
                                <% } %>
                            </select>
                        </div>

                        <div class="perfil-actions">
                            <button type="button" class="btn btn-primary-soft" id="btnAlterar">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                    <polyline points="7 3 7 8 15 8"></polyline>
                                </svg>
                                Salvar dados
                            </button>
                            <button type="button" class="btn btn-outline-soft">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>

                <section class="perfil-section mt-4">
                    <div class="perfil-section-header">
                        <div>
                            <h4 class="perfil-title">Endereço</h4>
                            <p class="perfil-subtitle">Cadastre, edite ou adicione depois, esta parte é separada</p>
                        </div>
                        <button class="btn btn-outline-soft" type="button"
                            onclick="document.getElementById('enderecoCollapse').classList.toggle('show')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Gerenciar endereço
                        </button>
                    </div>

                    <div class="collapse" id="enderecoCollapse">
                        <form id="formEndereco" class="row g-3 mt-1">
                            <div class="col-md-4">
                                <label class="form-label" for="cepInput">CEP <span style="color: red;">*</span></label>
                                <input id="cepInput" name="cep" type="text" class="form-control soft-control"
                                    placeholder="Somente números, 8 dígitos" inputmode="numeric" maxlength="8" />
                            </div>

                            <div class="col-md-8">
                                <label class="form-label" for="logradouroInput">Logradouro <span style="color: red;">*</span></label>
                                <input id="logradouroInput" name="logradouro" type="text"
                                    class="form-control soft-control" placeholder="Rua, avenida, etc" />
                            </div>

                            <div class="col-md-4">
                                <label class="form-label" for="numeroInput">Número</label>
                                <input id="numeroInput" name="numero" type="text" class="form-control soft-control"
                                    placeholder="Ex, 123, 12A" maxlength="7" />
                            </div>

                            <div class="col-md-8">
                                <label class="form-label" for="complementoInput">Complemento</label>
                                <input id="complementoInput" name="complemento" type="text"
                                    class="form-control soft-control" placeholder="Apto, bloco, casa, etc" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" for="bairroInput">Bairro <span style="color: red;">*</span></label>
                                <input id="bairroInput" name="bairro" type="text" class="form-control soft-control"
                                    placeholder="Seu bairro" />
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" for="cidadeInput">Cidade <span style="color: red;">*</span></label>
                                <input id="cidadeInput" name="cidade" type="text" class="form-control soft-control"
                                    placeholder="Sua cidade" />
                            </div>

                            <div class="col-md-4">
                                <label class="form-label" for="estadoInput">UF <span style="color: red;">*</span></label>
                                <input id="estadoInput" name="estado" type="text"
                                    class="form-control soft-control text-uppercase" placeholder="SP" maxlength="2"
                                    style="text-transform: uppercase;" />
                            </div>

                            <div class="col-md-8">
                                <label class="form-label" for="paisInput">País <span style="color: red;">*</span></label>
                                <input id="paisInput" name="pais" type="text" class="form-control soft-control"
                                    placeholder="Brasil" />
                            </div>

                            <div class="col-12">
                                <div class="perfil-actions">
                                    <button type="button" class="btn btn-primary-soft" id="btnRegistrarEndereco">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z">
                                            </path>
                                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                            <polyline points="7 3 7 8 15 8"></polyline>
                                        </svg>
                                        Salvar endereço
                                    </button>
                                    <button type="button" class="btn btn-outline-danger-soft" id="btnLimparCampo">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"></polyline>
                                            <path
                                                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                            </path>
                                        </svg>
                                        Remover endereço
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>

                <section class="perfil-section mt-4">
                    <div class="perfil-section-header">
                        <div>
                            <h4 class="perfil-title">Endereços registrados</h4>
                            <p class="perfil-subtitle">Veja os seus endereços aqui, e altere entre eles.</p>
                        </div>
                    </div>

                    <% listaEndereco.forEach((endereco, index) => { %>
                        <% if(endereco.usuID === "") { %>
                            <div class="address-card">
                                <div class="address-summary">
                                    <div class="address-main">
                                        <h5 class="address-title">Nenhum endereço cadastrado ainda.</h5>
                                        <span class="address-mini">
                                            -------- • -------- • --------
                                        </span>
                                    </div>
                                </div>
                            </div>

                        <% } else { %>
                            <div class="address-card">
                                <div class="address-summary" onclick="this.parentElement.classList.toggle('open')">
                                    <div class="address-main">
                                        <h5 class="address-title">Endereço</h5>
                                        <span class="address-mini">
                                            <%= listaEndereco[index].endEstado %> • <%= listaEndereco[index].endCep %> • Nº <%= listaEndereco[index].endNumero %>
                                        </span>
                                    </div>

                                    <button type="button" class="address-toggle">
                                        ▼
                                    </button>
                                </div>

                                <div class="address-details">
                                    <p><strong>Logradouro:</strong> <%= listaEndereco[index].endLogradouro %></p>
                                    <p><strong>Bairro:</strong> <%= listaEndereco[index].endBairro %></p>
                                    <p><strong>Cidade:</strong> <%= listaEndereco[index].endCidade %> - <%= listaEndereco[index].endEstado %></p>
                                    <p><strong>País:</strong> <%= listaEndereco[index].endPais %></p>

                                    <div class="address-actions">
                                        <!-- <button class="btn btn-primary-soft btn-small btnPadrao">
                                            Ativar como padrão
                                        </button> -->

                                        <button class="btn btn-outline-danger-soft btn-small btnDeletar" data-delete-address-profile="<%= listaEndereco[index].endID %>">
                                            Remover
                                        </button>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                    <% }) %>
                    
                </section>
            </main>
        </div>
    </div>
</div>

<script src="/js/apiViacep.js"></script>
<script src="/js/register.js"></script>
<script src="/js/alterar.js"></script>
<script src="/js/delete.js"></script>

<script>
    const btnTrocarFoto = document.getElementById("btnTrocarFoto");
    const avatarInput = document.getElementById("avatarInput");
    const avatarPreview = document.getElementById("avatarPreview");

    btnTrocarFoto.addEventListener("click", () => avatarInput.click());

    avatarInput.addEventListener("change", () => {
        const file = avatarInput.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = e => {
            avatarPreview.src = e.target.result;
        };
        reader.readAsDataURL(file);
    });
</script>
